<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¤Ù‚Øª Ø§Ù„ØªØ±ÙƒÙŠØ²</title>
    <style>
        /* 1. Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Dark Blue / Neon Blue) */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: linear-gradient(135deg, #0d1e2e 0%, #173f5f 100%); 
            color: #ecf0f1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .header {
            color: white;
            padding: 15px 20px;
            text-align: center;
            background-color: rgba(255, 255, 255, 0.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
        }

        .header h1 { margin: 0; font-size: 1.8em; color: #00e0ff; }

        .back-button {
            position: absolute;
            top: 20px;
            right: 20px;
            text-decoration: none;
            font-size: 1.2em;
            color: #00e0ff;
        }

        .timer-container {
            max-width: 500px;
            width: 90%;
            padding: 30px;
            border-radius: 15px;
            background-color: rgba(255, 255, 255, 0.05);
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            margin-top: 100px; 
        }
        
        #current-task {
            font-size: 1.2em;
            color: #00e0ff;
            margin-bottom: 20px;
        }

        #timer-display {
            font-size: 5em;
            font-weight: bold;
            color: white;
            margin: 20px 0;
            text-shadow: 0 0 10px #00e0ff;
        }

        .controls button {
            background-color: #00bcd4;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 5px;
            transition: background-color 0.3s;
        }

        .controls button:hover {
            background-color: #0097a7;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ù‚Ø³Ù… Ø§Ù„ØµÙˆØª */
        .sound-controls {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sound-controls label {
            display: block;
            margin-bottom: 10px;
            color: #ecf0f1;
        }

        .sound-controls select {
            background-color: #0d1e2e;
            color: #00e0ff;
            border: 1px solid #00e0ff;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 1em;
            width: 100%;
            max-width: 300px;
            margin-bottom: 10px;
            text-align: right; 
            direction: rtl; 
        }

        .sound-controls input[type="range"] {
            width: 100%;
            max-width: 300px;
            -webkit-appearance: none;
            height: 5px;
            background: #00e0ff;
            border-radius: 5px;
            margin-top: 10px;
        }
        
        #toggle-sound-btn {
            background-color: #4caf50;
            margin-bottom: 15px;
        }
        
        .timer-finished {
            color: #f44336; /* Ù„ÙˆÙ† Ø£Ø­Ù…Ø± Ù„Ù„ØªÙ†Ø¨ÙŠÙ‡ */
            text-shadow: 0 0 10px #f44336;
        }

    </style>
</head>
<body>

    <div class="header">
        <a href="todo.html" class="back-button">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù‡Ø§Ù…</a>
        <h1>Ù…Ø¤Ù‚Øª Ø§Ù„ØªØ±ÙƒÙŠØ² Ø§Ù„Ù†Ø´Ø·</h1>
    </div>

    <div class="timer-container">
        
        <p id="current-task">Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
        
        <div id="timer-display">25:00</div>

        <div class="controls">
            <button id="start-pause-btn" onclick="startPauseTimer()">Ø§Ø¨Ø¯Ø£</button> 
            <button onclick="resetTimer()">Ø¥ÙŠÙ‚Ø§Ù ÙˆØ¥Ø¹Ø§Ø¯Ø©</button> 
        </div>
        
        <div class="sound-controls">
            <h2>ğŸ§ Ø£ØµÙˆØ§Øª Ø§Ù„ØªØ±ÙƒÙŠØ² Ø§Ù„Ù…Ø­ÙŠØ·Ø©</h2>
            <label for="ambient-sound-select">Ø§Ø®ØªØ± ØµÙˆØªØ§Ù‹ Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ±ÙƒÙŠØ²:</label>
            <select id="ambient-sound-select">
                <option value="">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØµÙˆØª (Ø¥ÙŠÙ‚Ø§Ù)</option>
                <option value="rain.wav">ØµÙˆØª Ø§Ù„Ù…Ø·Ø± Ø§Ù„Ù‡Ø§Ø¯Ø¦</option>
                <option value="waves.wav">ØµÙˆØª Ø§Ù„Ù…ÙˆØ¬Ø§Øª Ø§Ù„Ù‡Ø§Ø¯Ø¦Ø©</option>
            </select>
            
            <button id="toggle-sound-btn" onclick="toggleAmbientSound()">ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª</button> 
            
            <label for="volume-control">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª:</label>
            <input type="range" id="volume-control" min="0" max="1" step="0.1" value="0.5">
            
        </div>
    </div>

    <script>
        const timerDisplay = document.getElementById('timer-display');
        const startPauseBtn = document.getElementById('start-pause-btn');
        const ambientSoundSelect = document.getElementById('ambient-sound-select');
        const volumeControl = document.getElementById('volume-control');
        const toggleSoundBtn = document.getElementById('toggle-sound-btn'); 
        
        let intervalId;
        let isRunning = false;
        let ambientAudio = new Audio(); 
        let isAmbientPlaying = false; 
        
        const ALARM_SOUND_URL = "alarm.wav"; 

        // ğŸ†• Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ø¯Ø© Ù…Ù† Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙØ­Ø© (URL Parameter)
        function getDurationFromURL() {
            const params = new URLSearchParams(window.location.search);
            // Ù†Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø³Ù…Ø§Ø© 'duration'
            const durationMinutes = parseInt(params.get('duration'));
            
            // Ù†ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù‚ÙŠÙ…Ø© Ø±Ù‚Ù… ØµØ­ÙŠØ­ ÙˆÙ…ÙˆØ¬Ø¨
            if (!isNaN(durationMinutes) && durationMinutes > 0) {
                // Ù†Ø¶Ø±Ø¨ ÙÙŠ 60 Ù„Ù„ØªØ­ÙˆÙŠÙ„ Ù…Ù† Ø¯Ù‚ÙŠÙ‚Ø© Ø¥Ù„Ù‰ Ø«Ø§Ù†ÙŠØ©
                return durationMinutes * 60;
            }
            // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: 25 Ø¯Ù‚ÙŠÙ‚Ø© (1500 Ø«Ø§Ù†ÙŠØ©)
            return 1500; 
        }

        // ğŸ†• Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ù„Ø© Ù„ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
        let initialSeconds = getDurationFromURL();
        let totalSeconds = initialSeconds; 

        // 1. ÙˆØ¸ÙŠÙØ© ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¤Ù‚Øª
        function updateDisplay() {
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            timerDisplay.textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // 2. ÙˆØ¸ÙŠÙØ© ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø­ÙŠØ· 
        function playAmbientSound() {
            const selectedSound = ambientSoundSelect.value;
            if (!selectedSound) return;
            
            if (ambientAudio.src.indexOf(selectedSound) === -1) {
                ambientAudio.src = selectedSound;
            }
            
            ambientAudio.loop = true; 
            ambientAudio.volume = volumeControl.value;

            ambientAudio.play().then(() => {
                isAmbientPlaying = true;
                toggleSoundBtn.textContent = 'Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª';
                toggleSoundBtn.style.backgroundColor = '#f44336'; 
            }).catch(e => {
                console.log("Ambient audio blocked. User interaction required.");
            });
        }

        // 3. ÙˆØ¸ÙŠÙØ© Ø¥ÙŠÙ‚Ø§Ù ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø­ÙŠØ· 
        function stopAmbientSound() {
            if (ambientAudio) {
                ambientAudio.pause();
                ambientAudio.currentTime = 0; 
                isAmbientPlaying = false;
                toggleSoundBtn.textContent = 'ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª';
                toggleSoundBtn.style.backgroundColor = '#4caf50'; 
            }
        }
        
        // 4. ÙˆØ¸ÙŠÙØ© ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„ÙŠØ¯ÙˆÙŠØ© (Ù…Ø±Ø¨ÙˆØ·Ø© Ø¨Ø§Ù„Ø²Ø±)
        function toggleAmbientSound() {
            if (ambientSoundSelect.value === "") {
                stopAmbientSound();
                alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØª Ø£ÙˆÙ„Ø§Ù‹ Ù„ØªØ´ØºÙŠÙ„Ù‡.");
                return;
            }
            
            if (isAmbientPlaying) {
                stopAmbientSound();
            } else {
                playAmbientSound();
            }
        }
        
        // 5. ÙˆØ¸ÙŠÙØ© Ø¨Ø¯Ø¡/Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª Ø§Ù„Ù…Ø¤Ù‚Øª
        function startPauseTimer() {
            if (!isRunning) {
                // START
                isRunning = true;
                startPauseBtn.textContent = 'Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª';
                startPauseBtn.style.backgroundColor = '#ff9800'; 
                timerDisplay.classList.remove('timer-finished');
                
                intervalId = setInterval(() => {
                    totalSeconds--;
                    updateDisplay();
                    
                    if (totalSeconds <= 0) {
                        clearInterval(intervalId);
                        isRunning = false;
                        startPauseBtn.textContent = 'Ø§Ù†ØªÙ‡Ù‰! Ø§Ù†Ù‚Ø± Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø·';
                        startPauseBtn.style.backgroundColor = '#f44336'; 
                        timerDisplay.classList.add('timer-finished');
                        
                        // ğŸ”” ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
                        const alarmAudio = new Audio(ALARM_SOUND_URL); 
                        alarmAudio.play().catch(e => console.log("Alarm audio blocked."));
                        
                        // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø­ÙŠØ· (Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØ¹Ù…Ù„)
                        stopAmbientSound();
                    }
                }, 1000);
            } else {
                // PAUSE
                clearInterval(intervalId);
                isRunning = false;
                startPauseBtn.textContent = 'Ø§Ø³ØªØ¦Ù†Ø§Ù';
                startPauseBtn.style.backgroundColor = '#00bcd4'; 
            }
        }

        // 6. ÙˆØ¸ÙŠÙØ© Ø¥ÙŠÙ‚Ø§Ù ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù…Ø¤Ù‚Øª
        function resetTimer() {
            clearInterval(intervalId);
            isRunning = false;
            startPauseBtn.textContent = 'Ø§Ø¨Ø¯Ø£';
            startPauseBtn.style.backgroundColor = '#00bcd4';
            timerDisplay.classList.remove('timer-finished');

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¯Ø© Ø§Ù„ØªÙŠ ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
            totalSeconds = initialSeconds; 
            updateDisplay();
            stopAmbientSound(); 
            
            document.getElementById('current-task').textContent = 'Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù…Ù†Ø¸Ù… Ø§Ù„Ù…Ù‡Ø§Ù….';
        }
        
        // 7. ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØµÙØ­Ø©
        function loadSession() {
            updateDisplay();
            
            volumeControl.addEventListener('input', () => {
                if (ambientAudio) {
                    ambientAudio.volume = volumeControl.value;
                }
            });

            ambientSoundSelect.addEventListener('change', () => {
                if (isAmbientPlaying) {
                     stopAmbientSound();
                     setTimeout(playAmbientSound, 100); 
                } else if (ambientSoundSelect.value !== "") {
                    toggleSoundBtn.textContent = 'ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª';
                    toggleSoundBtn.style.backgroundColor = '#4caf50'; 
                }
            });
        }
        
        loadSession();

    </script>
</body>
</html>
